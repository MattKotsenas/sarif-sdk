pr:
- 'main'

pool:
  vmImage: 'windows-latest'

resources:
  repositories:
    - repository: 1esPipelines
      type: git
      name: 1ESPipelineTemplates/1ESPipelineTemplates
      ref: refs/tags/release
extends:
    template: v1/1ES.Unofficial.PipelineTemplate.yml@1esPipelines
    parameters:
      pool:
        name: 1ES-Shared-Hosted-Pool_Windows-Server-2022
        os: windows      
      
      sdl:
        suppression:
          suppressionFile: $(Build.SourcesDirectory)\guardian\SDL\.gdnsuppress
        
      stages:
        - stage: build
          jobs:
            - job: build        
              templateContext:
                inputs:
                  - input: checkout
                    repository: self
                    submodules: recursive
                outputs:
                  - output: pipelineArtifact
                    targetPath: $(System.DefaultWorkingDirectory)
          
              steps:
                - task: PowerShell@2
                  displayName: Build and Test
                  inputs:
                    targetType: filePath
                    filePath: $(System.DefaultWorkingDirectory)/scripts/BuildAndTest.ps1

                # Build Multitool for npm
                - task: PowerShell@2
                  displayName: Build Multitool for npm
                  inputs:
                    targetType: filePath
                    filePath: $(System.DefaultWorkingDirectory)/scripts/BuildMultitoolForNpm.ps1
                